- id: '1593612773178'
  alias: Remote - Select Activity
  description: ''
  trigger:
  - entity_id: input_select.harmony
    from: Select Activity
    platform: state
  condition: []
  action:
  - data:
      data_template:
        activity: "{% if is_state(\"input_select.harmony\", \"Watch Plex\") %}\n \
          \ 27670057\n{% elif is_state(\"input_select.harmony\", \"Watch DVD\") %}\n\
          \  37587221\n{% elif is_state(\"input_select.harmony\", \"Power Off\") %}\n\
          \  -1\n{% else %} {% endif %}"
    entity_id: remote.living_room
    service: remote.turn_on
  - data:
      option: Select Activity
    entity_id: input_select.harmony
    service: input_select.select_option
- id: '1577904430400'
  alias: System - Dropbox Backup Sync
  description: Synchronize hass.io snapshots to Dropbox
  trigger:
  - at: '12:00:00'
    platform: time
  condition:
  - after: '12:00:00'
    before: 02:00:00
    condition: time
    weekday:
    - sun
  action:
  - data:
      addon: 7be23ff5_dropbox_sync
      input:
        command: upload
    service: hassio.addon_stdin
  mode: single
- id: '1591481819436'
  alias: System - Startup Tasks
  description: ''
  trigger:
  - event: start
    platform: homeassistant
  condition: []
  action:
  - delay: 00:00:20
  - data:
      addon: a0d7b954_nodered
    service: hassio.addon_restart
  - service: hassio.addon_restart
    data:
      addon: 03cabcc9_ring_mqtt
  - data:
      payload: announce
      topic: shellies/command
    service: mqtt.publish
  mode: single
- id: '1603043020584'
  alias: Doorbell - Front Ring
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.doorbell_doorbell
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: time
    after: 08:00:00
    before: '22:00:00'
  - condition: state
    entity_id: group.family_devices
    state: home
  action:
  - service: media_player.play_media
    data:
      media_content_id: https://home.eatsleepbreach.ca/local/doorbell_front.mp3
      media_content_type: music
    target:
      device_id:
      - c038376b0bd411ebb661915fc419dff9
      - c03750400bd411ebbd21d302c0018c1a
  - service: camera.play_stream
    data:
      media_player: media_player.master_bedroom_display
    target:
      device_id: 5f628eea7411345bf14420a07eaa74b3
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - service: media_player.turn_off
    data: {}
    entity_id: media_player.master_bedroom_display
  mode: single
- id: '1602687924312'
  alias: Cover - Garage Door Opened
  description: ''
  trigger:
  - platform: state
    entity_id: cover.garage_door
    from: closed
    to: open
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - service: notify.ios_all_devices
    data:
      message: Garage Cover has been opened.
      title: 🚗 Garage Cover Opened!
      data:
        attachment:
          content-type: jpeg
          hide-thumbnail: false
        push:
          category: camera
        entity_id: camera.garage_snapshot
  mode: single
- id: '1602786040005'
  alias: Notify - Mailbox
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.vibration_mailbox
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - service: notify.ios_all_devices
    data:
      message: You've got mail!
      title: 📬 Mailbox
      data:
        attachment:
          content-type: jpeg
          hide-thumbnail: false
        push:
          category: camera
        entity_id: camera.front_door_snapshot
  mode: single
- id: '1591375582026'
  alias: Lock - Secure all at 10pm
  description: ''
  trigger:
  - at: '22:00:00'
    platform: time
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - data: {}
    service: lock.lock
    target:
      device_id:
      - 87bc70b6345efdbf37f8c5b676cf3e4d
      - 17ad4d3482096182954b88c4f35bb21f
      - 5fa5f875376772df0a5008c64b7b4eea
  mode: single
- id: '1602346908294'
  alias: Lock - Front Door Unlocked
  description: ''
  trigger:
  - platform: device
    device_id: 17ad4d3482096182954b88c4f35bb21f
    domain: lock
    entity_id: lock.front_door_lock
    type: unlocked
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: numeric_state
    entity_id: sensor.uptime_minutes
    above: '2.0'
  - type: is_no_motion
    condition: device
    device_id: 94100d32e36a54fb98249b20d7ecfe4c
    entity_id: binary_sensor.motion_inside_front_door
    domain: binary_sensor
    for:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
  action:
  - service: notify.ios_all_devices
    data:
      message: Front Door has been opened.
      title: 🚪 Front Door Unlocked!
      data:
        attachment:
          content-type: jpeg
          hide-thumbnail: false
        push:
          category: camera
        entity_id: camera.front_door_snapshot
  mode: single
- id: '1603502802809'
  alias: Lock - Back Door Unlocked
  description: ''
  trigger:
  - platform: device
    device_id: 87bc70b6345efdbf37f8c5b676cf3e4d
    domain: lock
    entity_id: lock.back_door_lock
    type: unlocked
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: numeric_state
    entity_id: sensor.uptime_minutes
    above: '2.0'
  - type: is_no_motion
    condition: device
    device_id: ae949343c5f669ba4a357bd3d6ff8fa7
    entity_id: binary_sensor.motion_inside_back_door
    domain: binary_sensor
    for:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
  action:
  - service: notify.ios_all_devices
    data:
      message: Back Door has been opened.
      title: 🚪 Back Door Unlocked!
      data:
        attachment:
          content-type: jpeg
          hide-thumbnail: false
        push:
          category: camera
        entity_id: camera.back_door_snapshot
  mode: single
- id: '1602687787297'
  alias: Lock - Garage Door Unlocked
  description: ''
  trigger:
  - platform: device
    device_id: 5fa5f875376772df0a5008c64b7b4eea
    domain: lock
    entity_id: lock.garage_door_lock
    type: unlocked
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: numeric_state
    entity_id: sensor.uptime_minutes
    above: '2.0'
  - condition: state
    entity_id: binary_sensor.motion_garage
    state: 'off'
    for: 00:00:10
  action:
  - service: notify.ios_all_devices
    data:
      message: Garage Door has been opened.
      title: 🚪 Garage Door Unlocked!
      data:
        attachment:
          content-type: jpeg
          hide-thumbnail: false
        push:
          category: camera
        entity_id: camera.back_door_snapshot
  mode: single
- id: '1602440187444'
  alias: Amps - Power Control
  description: ''
  trigger:
  - platform: state
    entity_id: media_player.patio_speaker
  - platform: state
    entity_id: media_player.master_bedroom_speaker
  - platform: state
    entity_id: media_player.kitchen_ceiling
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''playing'' }}'
      sequence:
      - service: switch.turn_on
        data: {}
        entity_id: switch.amp
    default:
    - service: switch.turn_off
      data: {}
      entity_id: switch.amp
  mode: single
- id: '1602435177490'
  alias: Light - Seasonal Effects
  description: ''
  trigger:
  - platform: state
    entity_id: light.front_porch
    to: 'on'
    from: 'off'
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: sensor.month
        state: December
      sequence:
      - service: light.turn_on
        data:
          effect: Christmas
        entity_id: light.front_porch
    - conditions:
      - condition: state
        entity_id: sensor.month
        state: October
      sequence:
      - service: light.turn_on
        data:
          effect: Halloween
    default: []
  mode: single
- id: '1602430306575'
  alias: Light - Sunrise
  description: ''
  trigger:
  - platform: sun
    event: sunrise
    offset: 00:10:00
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - service: switch.turn_off
    data:
      entity_id: switch.front_door, switch.back_door, switch.garage_exterior_lights
  - type: turn_off
    device_id: 38d965d356ff44218994d149daf1634c
    entity_id: light.front_porch
    domain: light
  mode: single
- id: '1602430417396'
  alias: Light - Sunset
  description: ''
  trigger:
  - platform: sun
    event: sunset
    offset: -00:05:00
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - service: switch.turn_on
    data:
      entity_id: switch.front_door, switch.back_door, switch.garage_exterior_lights
  - service: light.turn_on
    data:
      brightness_pct: 100
      color_name: yellow
    entity_id: light.front_porch
  mode: single
- id: '1598110682886'
  alias: Cover - Garage Cover Open for 5 Minutes
  description: ''
  trigger:
  - entity_id: cover.garage_door
    for: 00:05:00
    from: closed
    platform: state
    to: open
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - data:
      actions:
      - action: close_garage
        title: Close Garage Door
      message: Garage door has been open for 5 minutes. Close it?
      title: 🚙 Garage left open!
    service: notify.ios_all_devices
  mode: single
- id: '1602273830036'
  alias: Laundry - Washer Cycle Complete
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.washer
    from: 0:02
    to: 0:01
    attribute: remain_time
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - service: notify.ios_all_devices
    data:
      title: 👕 Washer is done!
      message: '{%- if is_state(''sensor.dryer'', ''on'') %}Dryer will be done in
        {{ relative_time(states.sensor.dryer.attributes.remain_time) }}{%- else -%}Cycle
        took {{ relative_time(states.sensor.washer.attributes.initial_time) }}{% endif
        %}'
  mode: single
- id: '1602274353769'
  alias: Laundry - Dryer Cycle Complete
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.dryer
    attribute: remain_time
    to: 0:01
    from: 0:02
  condition: []
  action:
  - service: notify.ios_all_devices
    data:
      title: 🧦 Dryer is done!
      message: '{%- if is_state(''sensor.washer'', ''on'') %}Washer will be done in
        {{ relative_time(states.sensor.washer.attributes.remain_time) }}{%- else -%}Cycle
        took {{ relative_time(states.sensor.dryer.attributes.initial_time) }}{% endif
        %}'
  mode: single
- id: '1604401387451'
  alias: Light - Lamp Brightness
  description: ''
  trigger:
  - platform: state
    entity_id: light.bedroom_lamp
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: time
    before: 08:00:00
    after: '20:00:00'
  action:
  - service: light.turn_on
    data:
      brightness: 1
    entity_id: light.bedroom_lamp
  mode: single
- id: '1604869773228'
  alias: System - Reset Monthly Counters
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.dateofthemonth
    to: 1st
  condition: []
  action:
  - service: counter.reset
    data: {}
    entity_id: counter.front_door_motion_events
  - service: counter.reset
    data: {}
    entity_id: counter.doorbell_motion_events
  - service: counter.reset
    data: {}
    entity_id: counter.back_door_motion_events
  mode: single
- id: '1604942076638'
  alias: Notify - Cabinets Open
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.door_game_cabinet_left
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: binary_sensor.door_game_cabinet_middle
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: binary_sensor.door_game_cabinet_right
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: binary_sensor.door_dunny_cabinet
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - service: notify.mobile_app_iphone
    data:
      message: Access Detected!
      title: 🎮 {{ trigger.to_state.attributes.friendly_name }}
      data:
        attachment:
          content-type: jpeg
          hide-thumbnail: false
        push:
          category: camera
        entity_id: camera.entryway
  mode: single
- id: '1605135271786'
  alias: Shower - Close Bedroom Blinds
  description: ''
  trigger:
  - platform: state
    entity_id: light.light_shower
    to: 'on'
    for: 00:00:05
  condition:
  - condition: state
    entity_id: cover.blinds_joels_room
    state: open
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - service: cover.close_cover
    data: {}
    entity_id: cover.blinds_joels_room
  mode: single
- id: '1605809987611'
  alias: Waste Collection - Blue Bin Alert
  description: ''
  trigger:
  - platform: time
    at: '17:00:00'
  condition:
  - condition: state
    entity_id: sensor.blue_bin
    state: Tomorrow
  action:
  - service: light.turn_on
    data:
      brightness_pct: 100
      color_name: blue
    entity_id: light.kitchen_left_led
  mode: single
- id: '1605810026447'
  alias: Waste Collection - Green Bin Alert
  description: ''
  trigger:
  - platform: time
    at: '17:00:00'
  condition:
  - condition: state
    entity_id: sensor.green_bin
    state: Tomorrow
  action:
  - service: light.turn_on
    data:
      brightness_pct: 100
      color_name: green
    entity_id: light.kitchen_right_led
  mode: single
- id: '1605810087167'
  alias: Waste Collection - Black Bin Alert
  description: ''
  trigger:
  - platform: time
    at: '17:00:00'
  condition:
  - condition: state
    entity_id: sensor.black_bin
    state: tomorrow
  action:
  - service: light.turn_on
    data:
      brightness_pct: 100
      color_name: red
    entity_id: light.kitchen_cabinets
  mode: single
- id: '1606157806943'
  alias: Modem - Reboot
  description: Reboots the modem if the gateway WAN interface is down
  trigger:
  - platform: state
    entity_id: sensor.pfsense_gateway_wan_dhcp
    to: 'False'
    for: 00:02:00
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - repeat:
      until:
      - condition: state
        entity_id: sensor.pfsense_gateway_wan_dhcp
        state: 'True'
      sequence:
      - service: notify.mobile_app_iphone
        data:
          message: WAN gateway failed, rebooting.
          title: 🖀 Modem Failure!
      - service: switch.turn_off
        data: {}
        entity_id: switch.modem
      - delay:
          hours: 0
          minutes: 0
          seconds: 30
          milliseconds: 0
      - service: switch.turn_on
        data: {}
        entity_id: switch.modem
      - delay: 00:30:00
  mode: single
- id: '1607991157120'
  alias: Notify - Refrigerator Open
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: 22563bf3546620268953e47f24177bf8
    entity_id: binary_sensor.door_refridgerator
    domain: binary_sensor
    for:
      hours: 0
      minutes: 5
      seconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - repeat:
      until:
      - type: is_not_open
        condition: device
        device_id: 22563bf3546620268953e47f24177bf8
        entity_id: binary_sensor.door_refridgerator
        domain: binary_sensor
      sequence:
      - service: notify.ios_all_devices
        data:
          message: Close the fridge!
          title: 🧊 Refrigerator
      - delay: 00:02:00
  mode: single
- id: '1608008281551'
  alias: Alarm - Disarm
  description: ''
  trigger:
  - platform: time
    at: input_datetime.alarm_disarm
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: state
    entity_id: group.family_devices
    state: home
  action:
  - service: switch.turn_on
    data: {}
    entity_id: switch.garage_cover_outlet_2
  - service: alarm_control_panel.alarm_disarm
    data: {}
    entity_id: alarm_control_panel.calgary_alarm
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.quiet_time
  mode: single
- id: '1608334851404'
  alias: Alarm - Arm Home
  description: ''
  trigger:
  - platform: time
    at: input_datetime.alarm_arm
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: state
    entity_id: group.family_devices
    state: home
  - condition: state
    entity_id: group.locks
    state: locked
  - condition: state
    entity_id: group.alarm_sensors
    state: 'off'
  action:
  - service: switch.turn_off
    data: {}
    entity_id: switch.garage_cover_outlet_2
  - service: alarm_control_panel.alarm_arm_home
    data: {}
    entity_id: alarm_control_panel.calgary_alarm
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.quiet_time
  mode: single
- id: '1609684788084'
  alias: Alarm - Arm Away
  description: ''
  trigger:
  - platform: state
    entity_id: group.family_devices
    from: home
    to: not_home
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: state
    entity_id: input_boolean.guestmode
    state: 'off'
  action:
  - service: alarm_control_panel.alarm_arm_away
    data: {}
    entity_id: alarm_control_panel.calgary_alarm
  mode: single
- id: '1611778095556'
  alias: Camera - Weather Control
  description: Disable image processing due to weather
  trigger:
  - platform: state
    entity_id: weather.calgary_olympic_park
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: weather.calgary_olympic_park
        state: snowy
      sequence:
      - service: input_select.select_option
        data:
          option: Local
        entity_id: input_select.image_processing_mode
      - delay:
          hours: 0
          minutes: 10
          seconds: 0
          milliseconds: 0
    - conditions:
      - condition: state
        entity_id: weather.calgary_olympic_park
        state: rainy
      sequence:
      - service: input_select.select_option
        target:
          entity_id: input_select.image_processing_mode
        data:
          option: Local
      - delay:
          hours: 0
          minutes: 10
          seconds: 0
          milliseconds: 0
    default:
    - delay:
        hours: 0
        minutes: 30
        seconds: 0
        milliseconds: 0
  mode: single
- id: '1613012477376'
  alias: Music - White noise
  description: ''
  trigger:
  - platform: state
    entity_id: media_player.joels_room_speaker
    attribute: media_title
    to: White noise
  - platform: state
    entity_id: media_player.master_bedroom_display
    attribute: media_title
    to: White noise
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - service: media_player.volume_set
    data:
      volume_level: 0.8
      entity_id: '{{ trigger.entity_id }}'
  mode: single
- id: '1613599134512'
  alias: Printer - Power Control
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.lexmark_cs310_series
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: sensor.lexmark_cs310_series
          state: idle
      sequence:
      - service: switch.turn_on
        data: {}
        entity_id: switch.printer
    - conditions:
      - condition: state
        entity_id: sensor.lexmark_cs310_series
        state: idle
        for: 00:20:00
      sequence:
      - service: switch.turn_off
        data: {}
        entity_id: switch.printer
    default: []
  mode: single
- id: '1613942808856'
  alias: Space Heater - Temperature Control
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.master_bathroom_temperature
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: state
    entity_id: group.family_devices
    state: home
  action:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.master_bathroom_temperature
        below: '21.6'
      - condition: state
        entity_id: switch.space_heater
        state: 'off'
      - condition: time
        after: 06:00:00
        before: 09:00:00
      sequence:
      - service: switch.turn_on
        data: {}
        entity_id: switch.space_heater
    - conditions:
      - condition: numeric_state
        entity_id: sensor.master_bathroom_temperature
        above: '21.9'
      - condition: state
        entity_id: switch.space_heater
        state: 'on'
      sequence:
      - service: switch.turn_off
        data: {}
        entity_id: switch.space_heater
    default: []
  mode: single
- id: '1614301350375'
  alias: Camera - Cost Control
  description: Disable image processing due to count limit
  trigger:
  - platform: state
    entity_id: sensor.total_month_camera_events
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: not
    conditions:
    - condition: state
      entity_id: weather.calgary_olympic_park
      state: snowy
  action:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.total_month_camera_events
        above: '994.0'
      sequence:
      - service: input_select.select_option
        data:
          option: Local
        entity_id: input_select.image_processing_mode
    - conditions:
      - condition: numeric_state
        entity_id: sensor.total_month_camera_events
        below: '995.0'
      sequence:
      - service: input_select.select_option
        data:
          option: Cloud
        entity_id: input_select.image_processing_mode
    default: []
  mode: single
- id: '1614538081222'
  alias: Light - Basement Stairs
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: 44eae6990c494cfd8a209f98a436e74e
    entity_id: binary_sensor.basement_door
    domain: binary_sensor
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - condition: device
    type: is_off
    device_id: 8630210676794c5992b4a2c92a73f90d
    entity_id: switch.basement_stairs
    domain: switch
  - service: switch.turn_on
    data: {}
    entity_id: switch.basement_stairs
  - delay:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  mode: single
- id: '1614558915813'
  alias: Climate - Window Control
  description: ''
  trigger:
  - platform: state
    entity_id: group.all_windows
    for: 00:01:00
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: group.all_windows
        state: 'on'
      sequence:
      - service: climate.set_hvac_mode
        target:
          entity_id: climate.main_floor
        data:
          hvac_mode: fan_only
      - type: turn_off
        device_id: ee92ccea31d5f79493219f83ccf74b06
        entity_id: switch.humidifier
        domain: switch
    - conditions:
      - condition: state
        entity_id: group.all_windows
        state: 'off'
      sequence:
      - service: climate.set_hvac_mode
        target:
          entity_id: climate.main_floor
        data:
          hvac_mode: auto
      - type: turn_on
        device_id: ee92ccea31d5f79493219f83ccf74b06
        entity_id: switch.humidifier
        domain: switch
    default: []
  mode: single
- id: '1614829216486'
  alias: Light - Kitchen Night Light
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: cf02d2ad7ec8594e892e42aa8e5b01aa
    entity_id: binary_sensor.motion_hallway
    domain: binary_sensor
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: device
    type: is_off
    device_id: 5d5445200b93486c913a08288bae6621
    entity_id: switch.kitchen_light
    domain: switch
  - condition: device
    type: is_off
    device_id: e10c450fa7254d54804c43d5eaacbfcf
    entity_id: light.dining_room
    domain: light
  - condition: state
    entity_id: sun.sun
    state: below_horizon
  - condition: device
    type: is_off
    device_id: d0cd794a0c194393b3836b635d6220ee
    entity_id: light.island
    domain: light
  action:
  - service: light.turn_on
    data:
      color_name: yellow
    target:
      entity_id: light.kitchen_cabinets
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    data: {}
    entity_id: light.kitchen_cabinets
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  mode: single
- id: '1615395552931'
  alias: Blind - Dining Room
  description: ''
  trigger:
  - platform: sun
    event: sunset
    offset: 00:05:00
  - platform: time
    at: 08:30:00
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: state
    entity_id: input_select.blinds_dining_room_mode
    state: Automatic
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: sun.sun
        state: below_horizon
      - type: is_not_open
        condition: device
        device_id: 773fc559024ac11ecb6a9280b38a9bce
        entity_id: binary_sensor.dining_room_window
        domain: binary_sensor
        for:
          hours: 0
          minutes: 0
          seconds: 15
          milliseconds: 0
      sequence:
      - device_id: 27d4e2d3b62aeea7815697f4dafa12c7
        domain: cover
        entity_id: cover.blinds_dining_room
        type: set_position
    - conditions:
      - condition: state
        entity_id: sun.sun
        state: above_horizon
      - condition: time
        after: 08:30:00
      sequence:
      - device_id: 27d4e2d3b62aeea7815697f4dafa12c7
        domain: cover
        entity_id: cover.blinds_dining_room
        type: set_position
        position: 100
    default: []
  mode: single
- id: '1615478976864'
  alias: Switch - Basement Stairs Inactivity
  description: ''
  trigger:
  - platform: device
    type: turned_on
    device_id: 8630210676794c5992b4a2c92a73f90d
    entity_id: switch.basement_stairs
    domain: switch
    for:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - type: is_no_motion
    condition: device
    device_id: e8d280d931dfd93ddacfcfe74785c318
    entity_id: binary_sensor.stairway_motion
    domain: binary_sensor
  action:
  - type: turn_off
    device_id: 8630210676794c5992b4a2c92a73f90d
    entity_id: switch.basement_stairs
    domain: switch
  mode: single
- id: '1615652464813'
  alias: Blind - Library
  description: ''
  trigger:
  - platform: sun
    event: sunset
    offset: 00:05:00
  - platform: time
    at: 08:30:00
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: state
    entity_id: input_select.blinds_library_mode
    state: Automatic
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: sun.sun
        state: below_horizon
      - type: is_not_open
        condition: device
        device_id: 4c12bdfa77964af0ab5342561f3e6286
        entity_id: binary_sensor.library_window
        domain: binary_sensor
      sequence:
      - service: cover.close_cover
        target:
          device_id: df05ff97af8cc94daa4886f41221a920
    - conditions:
      - condition: state
        entity_id: sun.sun
        state: above_horizon
      - condition: time
        after: 08:30:00
      sequence:
      - service: cover.open_cover
        target:
          device_id: df05ff97af8cc94daa4886f41221a920
    default: []
  mode: single
- id: '1615652668231'
  alias: Blind - Stairway
  description: ''
  trigger:
  - platform: sun
    event: sunset
    offset: 00:05:00
  - platform: time
    at: 08:30:00
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: state
    entity_id: input_select.blinds_stairway_mode
    state: Automatic
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: sun.sun
        state: below_horizon
      sequence:
      - device_id: c929b61ad5321e3207f60bccc556b756
        domain: cover
        entity_id: cover.blinds_stairway
        type: set_position
    - conditions:
      - condition: state
        entity_id: sun.sun
        state: above_horizon
      - condition: time
        after: 08:30:00
      sequence:
      - device_id: c929b61ad5321e3207f60bccc556b756
        domain: cover
        entity_id: cover.blinds_stairway
        type: set_position
        position: 100
    default: []
  mode: single
- id: '1615652764733'
  alias: Blind - Joel's Room
  description: ''
  trigger:
  - platform: sun
    event: sunset
    offset: 00:05:00
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: sun.sun
        state: below_horizon
      sequence:
      - device_id: 269012f56589fb928303bc8dad06c38b
        domain: cover
        entity_id: cover.blinds_joels_room
        type: set_position
    default: []
  mode: single
- id: '1615654024825'
  alias: Light - Away and Forgotten
  description: Turns off lights if we are away but some were left on
  trigger:
  - platform: state
    entity_id: group.family_devices
    to: not_home
    for: 00:30:00
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: state
    entity_id: input_boolean.homesitter
    state: 'off'
  - condition: state
    entity_id: input_boolean.guestmode
    state: 'off'
  action:
  - service: switch.turn_off
    target:
      device_id:
      - 8630210676794c5992b4a2c92a73f90d
      - 5d5445200b93486c913a08288bae6621
  - service: light.turn_off
    target:
      device_id:
      - b81d2f783e3141c8ab4ba540ad2588f9
      - 92c693c7e4267438802e4bb8edbfa0bf
      - 2a6a260b4e91c9e047f88a0f2702267d
      - e10c450fa7254d54804c43d5eaacbfcf
      - d0cd794a0c194393b3836b635d6220ee
      - 906273b7b475468ea078b648fae1327b
      - 5a65f08231d24a079cfcf0d0f9c10717
      - 0ca9e01b57cc4159b389cf67344516ee
      entity_id: light.kitchen_cabinets
  mode: single
- id: '1615754157293'
  alias: Tag - Front Door Camera
  description: Turns off camera alerts when scanned
  trigger:
  - platform: tag
    tag_id: 07a17b17-1185-4176-b8ee-9e45dcab91e8
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - service: input_select.select_option
    data:
      option: Disabled
    target:
      entity_id: input_select.camera_person_alerts
  mode: single
- id: '1615757783776'
  alias: Tag - Back Door Camera
  description: Turns off camera alerts when scanned
  trigger:
  - platform: tag
    tag_id: d8e2ba2e-778c-41a1-a2ef-2a5a15142534
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - service: input_select.select_option
    data:
      option: Front Door
    target:
      entity_id: input_select.camera_person_alerts
  mode: single
- id: '1615761299458'
  alias: Tag - Alarm Disarm
  description: ''
  trigger:
  - platform: tag
    tag_id: c0633739-0e08-4507-8382-bba521aa3f01
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - device_id: d2f4d5b400ef24f2f92f7e5beb98fd34
    domain: alarm_control_panel
    entity_id: alarm_control_panel.calgary_alarm
    type: disarm
    code: ''
  mode: single
- id: '1615991554264'
  alias: Chromecasts - Reboot
  description: Reboot the chromecast audio devices when they become unavailable
  trigger:
  - platform: state
    entity_id: media_player.kitchen_ceiling
    to: unavailable
  - platform: state
    entity_id: media_player.master_bedroom_speaker
    to: unavailable
  - platform: state
    entity_id: media_player.patio_speaker
    to: unavailable
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: not
    conditions:
    - condition: state
      entity_id: media_player.kitchen_ceiling
      state: playing
  - condition: not
    conditions:
    - condition: state
      entity_id: media_player.master_bedroom_speaker
      state: playing
  - condition: not
    conditions:
    - condition: state
      entity_id: media_player.patio_speaker
      state: playing
  action:
  - service: switch.turn_off
    target:
      entity_id: switch.chromecasts
  - delay:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
  - service: switch.turn_on
    target:
      entity_id: switch.chromecasts
  mode: single
- id: '1618257119742'
  alias: Notify - Water Leak
  description: ''
  trigger:
  - type: moist
    platform: device
    device_id: 93cab1ca67efecc7af1a4d4841c788e7
    entity_id: binary_sensor.water_sump_pump
    domain: binary_sensor
  - type: moist
    platform: device
    device_id: c620f1b04c034258d051c9cc6e29577b
    entity_id: binary_sensor.water_hot_water_heater
    domain: binary_sensor
  - type: moist
    platform: device
    device_id: a3e6c0335670a17f6c6198501a2a9235
    entity_id: binary_sensor.water_dishwasher
    domain: binary_sensor
  - type: moist
    platform: device
    device_id: 2bc0e95fab5e927740fa29ab18554885
    entity_id: binary_sensor.water_laundry_water_main
    domain: binary_sensor
  - type: moist
    platform: device
    device_id: 5100179c9103586fe2d245e2fdea14c1
    entity_id: binary_sensor.water_master_bathroom_tub
    domain: binary_sensor
  - type: moist
    platform: device
    device_id: 3b76f90a4333a164bead1b10afdb7b78
    entity_id: binary_sensor.water_refrigerator
    domain: binary_sensor
  - type: moist
    platform: device
    device_id: 6c4dab48e8edf5a9a7bbb3d03f526370
    entity_id: binary_sensor.water_washing_machine
    domain: binary_sensor
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - service: notify.ios_all_devices
    data:
      message: Water Leak!
      title: "\U0001F4A7\t {{ trigger.to_state.attributes.friendly_name }}"
      data:
        push:
          sound:
            name: default
            critical: 1
            volume: 1
        attachment:
          url: https://home.eatsleepbreach.ca/local/cast_waterleak.png
          content-type: png
          hide-thumbnail: false
  mode: single
- id: '1618258170137'
  alias: Notify - Windows Open
  description: ''
  trigger:
  - platform: state
    entity_id: group.family_devices
    from: home
    to: not_home
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: state
    entity_id: group.all_windows
    state: 'on'
  action:
  - service: notify.ios_all_devices
    data:
      message: '{{ states | selectattr(''entity_id'',''in'', state_attr(''group.all_windows'',''entity_id''))
        | selectattr(''state'',''eq'',''on'') | map(attribute=''name'') | join('',
        '') }}

        '
      title: '🪟 Windows Open:'
      data: {}
  mode: single
- id: '1618258922360'
  alias: Quiet - Manage Volume
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.quiet_time
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.quiet_time
        state: 'on'
      sequence:
      - service: automation.turn_off
        target:
          entity_id: automation.doorbell_front_ring
      - service: media_player.volume_set
        target:
          entity_id:
          - media_player.dining_room_speaker
          - media_player.joels_room_speaker
          - media_player.kitchen_ceiling
          - media_player.kitchen_speaker
          - media_player.library_speaker
          - media_player.living_room_speaker
          - media_player.master_bedroom_display
          - media_player.master_bedroom_speaker
          - media_player.theater_speaker
          - media_player.office_speaker
        data:
          volume_level: 0.1
      - service: unifiprotect.set_doorbell_lcd_message
        data:
          entity_id: camera.doorbell
          message: Do Not Disturb
      - service: unifiprotect.set_doorbell_chime_duration
        data:
          entity_id: camera.doorbell
          chime_duration: 0
      - service: light.turn_off
        target:
          entity_id:
          - light.base_station_audio_settings
          - light.back_door_keypad_audio_settings
          - light.entryway_keypad_audio_settings
    - conditions:
      - condition: state
        entity_id: input_boolean.quiet_time
        state: 'off'
      sequence:
      - service: automation.turn_on
        target:
          entity_id: automation.doorbell_front_ring
      - service: media_player.volume_set
        target:
          entity_id:
          - media_player.dining_room_speaker
          - media_player.joels_room_speaker
          - media_player.kitchen_ceiling
          - media_player.kitchen_speaker
          - media_player.library_speaker
          - media_player.living_room_speaker
          - media_player.master_bedroom_display
          - media_player.master_bedroom_speaker
          - media_player.theater_speaker
          - media_player.office_speaker
        data:
          volume_level: 0.6
      - service: unifiprotect.set_doorbell_lcd_message
        data:
          entity_id: camera.doorbell
          message: Welcome
      - service: unifiprotect.set_doorbell_chime_duration
        data:
          entity_id: camera.doorbell
          chime_duration: 300
      - service: light.turn_on
        target:
          entity_id:
          - light.base_station_audio_settings
          - light.back_door_keypad_audio_settings
          - light.entryway_keypad_audio_settings
    default: []
  mode: single
- id: '1618260754009'
  alias: ISP - High Delay
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.pfsense_delay
    above: '10.00'
    for: 00:15:00
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - service: notify.mobile_app_iphone
    data:
      title: 🌐 High ISP Latency
      message: Gateway latency is {{ states.sensor.pfsense_gateway_wan_dhcp.attributes.delay
        }}
  mode: single
- id: '1618351062301'
  alias: Notify - Blue Bin
  description: ''
  trigger:
  - type: vibration
    platform: device
    device_id: d2cb50a852578cf532f7dfa1ba44bd8e
    entity_id: binary_sensor.vibration_blue_bin
    domain: binary_sensor
    for:
      hours: 0
      minutes: 0
      seconds: 15
      milliseconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: state
    entity_id: sensor.blue_bin
    state: today
  action:
  - service: notify.ios_all_devices
    data:
      title: ♻️ Blue Bin Activity
      message: The blue bin might have been collected
      data:
        attachment:
          content-type: jpeg
          hide-thumbnail: false
        push:
          category: camera
        entity_id: camera.back_door
  mode: single
- id: '1619560143233'
  alias: Humidifier - Humidity Control
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.master_bedroom_multi_sensor_2
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - choose:
    - conditions:
      - type: is_humidity
        condition: device
        device_id: 1d9fc783987a579033677c12a987f9f7
        entity_id: sensor.master_bedroom_multi_sensor_2
        domain: sensor
        above: 30
      sequence:
      - service: switch.turn_off
        target:
          device_id: ee92ccea31d5f79493219f83ccf74b06
    - conditions:
      - type: is_humidity
        condition: device
        device_id: 1d9fc783987a579033677c12a987f9f7
        entity_id: sensor.master_bedroom_multi_sensor_2
        domain: sensor
        below: 30
      - condition: state
        entity_id: group.all_windows
        state: 'off'
      sequence:
      - type: turn_on
        device_id: ee92ccea31d5f79493219f83ccf74b06
        entity_id: switch.humidifier
        domain: switch
    default: []
  mode: single
- id: '1619906631532'
  alias: Wall Tablet - Turn On With Motion
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 1150e56c5a20c542d66f808a2f7652a8
    entity_id: binary_sensor.motion_hallway_2
    domain: binary_sensor
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  - condition: time
    after: input_datetime.alarm_disarm
    before: input_datetime.alarm_arm
  - condition: numeric_state
    entity_id: sensor.powerstrip_electric_consumed_w_3
    above: '0.0'
  action:
  - service: notify.mobile_app_7510_home_ipad
    data:
      message: Automated Wake
      title: Tablet woken from motion
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  mode: single
- id: '1620053691684'
  alias: System - Certificate Expiry
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.certificate_expiry_days
    below: '20'
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - service: hassio.addon_start
    data:
      addon: core_letsencrypt
  - delay:
      hours: 0
      minutes: 15
      seconds: 0
      milliseconds: 0
  - service: hassio.addon_restart
    data:
      addon: core_nginx_proxy
  - service: homeassistant.restart
  mode: single
- id: '1620087317543'
  alias: Notify - Forgotten Washer
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.washer_wash_completed
    to: 'on'
    for: 01:00:00
  condition:
  - condition: state
    entity_id: input_boolean.automations
    state: 'on'
  action:
  - service: notify.ios_all_devices
    data:
      message: Did you forget the washer?
      title: 🧺 Washer
  mode: single
